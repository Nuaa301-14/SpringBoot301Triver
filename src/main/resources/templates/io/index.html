<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
	<meta charset="UTF-8">
	<title>首页--旅游网站</title>
	<link rel="stylesheet" href="../../static/io/css/iostyle.css">
	<link rel="stylesheet" href="../../static/io/css/basic.css">
	<link rel="icon" href="../../static/favicon.ico">
	<link rel="stylesheet" href="../../static/layui/css/layui.css" media="all" />
	<link rel="stylesheet" href="//at.alicdn.com/t/font_tnyc012u2rlwstt9.css" media="all" />

	<link rel="stylesheet" type="text/css" href="/static/css/list.css"/>
	<link rel="stylesheet" type="text/css" href="/static/css/manhuaDate.1.0.css"/>
	<script type="text/javascript" src="/static/js/jquery-1.5.1.js"></script><!--日期控件，JS库版本不能过高否则tab会失效-->
	<script type="text/javascript" src="/static/js/datejs.js"></script>
	<script type="text/javascript" src="/static/js/ui.tab.js"></script>
	<!--    <script type="text/javascript" src="/static/js/shaixuan.js"></script>-->
	<script type="text/javascript">
		$(document).ready(function () {
			var tab = new $.fn.tab({
				tabList: "#demo1 .ui-tab-container .ui-tab-list li",
				contentList: "#demo1 .ui-tab-container .ui-tab-content"
			});
			var tab = new $.fn.tab({
				tabList: "#demo1 .ui-tab-container .ui-tab-list2 li",
				contentList: "#demo1 .ui-tab-container .ui-tab-content2"
			});
		});
	</script>
	<script type="text/javascript">
		$(document).ready(function (e) {
			$("#selectList").find(".more").toggle(function () {
				$(this).addClass("more_bg");
				$(".more-none").show()
			}, function () {
				$(this).removeClass("more_bg");
				$(".more-none").hide()
			});
		});
	</script>
	<script type="text/javascript">
		$(document).ready(function () {
			var taboy_box = $(".lefttable-list");
			taboy_box.children("tbody").find("tr:gt(2)").hide();
			$(".leftbox-morea").toggle(function () {
						$(this).parent().prev().find("tr").show();
						$(this).addClass("more-i")
					}, function () {
						$(this).removeClass("more-i");
						$(this).parent().prev().children("tbody").find("tr:gt(2)").hide();
					}
			);
		});
	</script>
</head>
<body>
<header>
	<nav id="nav">
	<div id="logo"><img src="../../static/io/img/logo.png" alt=""></div>
	<ul>
		<li><a href="scenery.html">首页</a></li>
		<li><a href="informations.html">旅游资讯</a></li>
		<li><a href="ticket.html">酒店订购</a></li>
		<li class="active"><a href="index.html">景点资讯</a></li>
        <li class="layui-nav-item">
            <a href="/" th:if="${session.loginUser}==null">
                <cite th:text="请登录"></cite>
                <!--                    ${session.loginUser.userName}-->
            </a>
            <a href="/user/userInfo" th:if="${session.loginUser}!=null">
                <cite th:if="${session.loginUser.userName}!=null" th:text="你好+' '+${session.loginUser.userName}"></cite>
                <cite th:if="${session.loginUser.userName}==null" th:text="你好+' '+${session.loginUser.name}"></cite>
                <!--                    ${session.loginUser.userName}-->
            </a>
        </li>
	</ul>
	</nav>
</header>
<!--<div class="search">-->
<!--    <div class="center"></div>-->
<!--    <input class="input" type="text" placeholder="请输入旅游景点或城市" id="searchtext">-->
<!--    <div class="button searchBtn">-->
<!--        搜索-->
<!--	</div>-->
<!--</div>-->
<br>
<div class="w1200">
	<div class="list-screen">
		<div class="screen-top" style="position:relative;">
            <span>目的地
                <input id="txtadress" type="text"/>
            </span>
			<span>景区位置
                <input type="text" class="ju-adress" id="location"/>
            </span>
			<span>景区名称
                <input type="text" class="ju-name" id="spot_Name"/>
            </span>
			<a class="layui-btn layui-btn-danger search_btn" style="margin-left: 30px">具体查询</a>
		</div>
		<div style="padding:10px 30px 10px 10px;">
			<div class="screen-term">
				<div class="selectNumberScreen">
					<div id="selectList" class="screenBox screenBackground">
						<dl class="listIndex" attr="价格范围">
							<dt>门票价格</dt>
							<dd>
								<label><a href="javascript:;" values2="" values1="" attrval="不限">不限</a></label>
								<label>
									<input name="radio2" type="radio" value=""/>
									<a href="javascript:;" values2="99" values1="1" attrval="1-99">10元以下</a></label>
								<label>
									<input name="radio2" type="radio" value=""/>
									<a href="javascript:;" values2="300" values1="100"
									   attrval="100-300">10-50元 </a></label>
								<label>
									<input name="radio2" type="radio" value=""/>
									<a href="javascript:;" values2="600" values1="300"
									   attrval="300-600">50-100元</a></label>
								<label>
									<input name="radio2" type="radio" value=""/>
									<a href="javascript:;" values2="1500" values1="600"
									   attrval="5000以上">100-200元</a></label>
								<div class="custom"><span>自定义</span>&nbsp;
									<input name="" type="text" id="custext1"/>
									&nbsp;-&nbsp;
									<input name="" type="text" id="custext2"/>
									<input name="" type="button" id="cusbtn"/>
								</div>
							</dd>
						</dl>
						<dl class=" listIndex" attr="terminal_os_s">
							<dt>景区特色</dt>
							<dd>
								<label><a href="javascript:;" values2="" values1="" attrval="不限">不限</a> </label>
								<label>
									<input name="checkbox2" type="checkbox" value="" autocomplete="off"/>
									<a href="javascript:;" values2="" values1="" attrval="android">风光</a> </label>
								<label>
									<input name="checkbox2" type="checkbox" value="" autocomplete="off"/>
									<a href="javascript:;" values2="" values1="" attrval="symbian">乐园</a></label>
								<label>
									<input name="checkbox2" type="checkbox" value="" autocomplete="off"/>
									<a href="javascript:;" values2="" values1="" attrval="百度易平台">文化</a></label>
							</dd>
						</dl>
						<dl class="listIndex" attr="terminal_brand_s">
							<dt>来源</dt>
							<dd data-more=true>
								<label><a href="javascript:;" values2="" values1="" attrval="不限">不限</a></label>
								<label>
									<input name="checkbox2" type="checkbox" value="" autocomplete="off"/>
									<a href="javascript:;" values2="" values1="" attrval="小米">携程</a></label>
								<label>
									<input name="checkbox2" type="checkbox" value="" autocomplete="off"/>
									<a href="javascript:;" values2="" values1="" attrval="华为">同程</a> </label>
								<label>
									<input name="checkbox2" type="checkbox" value="" autocomplete="off"/>
									<a href="javascript:;" values2="" values1="" attrval="lenovo">艺龙</a> </label>
							</dd>
						</dl>
					</div>
				</div>
			</div>

		</div>
		<script type="text/javascript" src="/static/js/shaixuan.js"></script>
		<div class="hasBeenSelected clearfix"><span id="time-num"><font>0</font>个景点</span>
			<div style="float:right;" class="eliminateCriteria">【清空】</div>
			<dl>
				<dt>已选条件：</dt>
				<dd class=clearDd>
					<div id="show" class=clearList>
						<div id="showAllTag"></div>
					</div>
			</dl>
		</div>
	</div>
</div>
<div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';">
</div>

<div class="tour">
	<section class="news">
	<h2>热门旅游</h2>
	<p>国内旅游、国外旅游、自助旅游、自驾旅游、油轮签证、主题旅游等各种最新热门旅游推荐</p>
	</section>
	<link rel="stylesheet" href="/static/layui/css/layui.css" media="all">
	<script src="/static/layui/layui.all.js" charset="utf-8"></script>
	<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js" charset="utf-8"></script>
	<script >
        function loaddata()
        {
            $.ajax({
                //访问后台的路径
                url: "/load_data",
                dataType:"json",
                contentType: "application/json;charset=utf-8",
                type: 'post',//指定提交方式为post
                success: function(data) {
                    var jsonData = JSON.stringify(data);
                    var spotlist = {};
                    jQuery.each(JSON.parse(jsonData),function(i,item){
                        spotlist[i] = item;
                    });
                    dataHtml='';
                    for (var i=0;i<9;i++){
                        dataHtml+='<figure>'
                            +'<a href="'+spotlist[i].spotUrl+'" target="_blank"><img src="../../static/io/img/tour'+(i+1)+'.jpg" alt=""></a>'
                            + '<figcaption>'
                            + '<h3 class="content" > &lt;'+ spotlist[i].spotName +'&gt;</h3>'
                                + spotlist[i].introduce
                                +'<div class="info">'
                                +'<em class="sat">'+ '满意度'+spotlist[i].spotScore +'</em>'
                                +'<span class="price">'+ '￥'+spotlist[i].spotPrice +'</span>'
                                +'</div>'
                                +'<div>'+spotlist[i].spotLocation +'—'+spotlist[i].recommend+'人推荐'+'</div>'
                            +'</figcaption>'
                            +'</figure>'
                    }
                    $(".spotShow").html(dataHtml);
                }
            });
        }
        window.onload = loaddata;


        var pageIndex = 1;
        var pageSize = 9;
        var currentPageIndex = 1;
        var recordCount = 0;
        var result;
        $(".search_btn").click(function () {
            search(1);
        });

        function search(page){
            result = searchSpot();
            result.push({
                page:page,
                pageSize:9
            });
            var index = layer.msg('查询中，请稍候', {icon: 16, time: false, shade: 0.8});
            setTimeout(function () {
                tosubmit(result);
                toPage();
                layer.close(index);
            }, 4000);
        }

        function loadnextpage(page){
            result = searchSpot();
            result.push({
                page:page,
                pageSize:9
            });
            tosubmit(result);
        }

        function tosubmit(condition){
            $.ajax({
                //访问后台的路径
                url: "/onclick_search",
                //将数据通过函数转换
                data: JSON.stringify(condition),
                dataType: "json",//指定数据类型为JSON
                // 指定类型，不然会报错，无法解析提交类型
                contentType: "application/json;charset=utf-8",
                type: 'post',//指定提交方式为post
                success: function (data) {
                    pageIndex = data.pageNum;
                    recordCount = data.total;
                    if (data.list != null) {
                        getListInfo(data.list);
                    }
                }
            });

        }

        function getListInfo(data){
            var jsonData = JSON.stringify(data);
            var spotlist = {};
            jQuery.each(JSON.parse(jsonData), function (i, item) {
                spotlist[i] = item;
            });
            dataHtml = '';
            for (var i = 0; i < 9; i++) {
                dataHtml += '<figure>'
                    + '<a href="' + spotlist[i].spotUrl + '" target="_blank"><img src="../../static/io/img/tour' + (i + 1) + '.jpg" alt=""></a>'
                    + '<figcaption>'
                    + '<h3 class="content" > &lt;' + spotlist[i].spotName + '&gt;</h3>'
                    + spotlist[i].introduce
                    + '<div class="info">'
                    + '<em class="sat">' + '满意度' + spotlist[i].spotScore + '</em>'
                    + '<span class="price">' + '￥' + spotlist[i].spotPrice + '</span>'
                    + '</div>'
                    + '<div>' + spotlist[i].spotLocation + '———' + spotlist[i].recommend + '人推荐' + '</div>'
                    + '</figcaption>'
                    + '</figure>'
            }
            $(".spotShow").html(dataHtml);
        }


        function toPage() {
            layui.use(['laypage', 'layer'], function(){
                var laypage = layui.laypage
                    ,layer = layui.layer;
                //总页数大于页码总数
                laypage.render({
                    elem: 'page'
                    ,layout: ['count', 'prev', 'page', 'next' ]
                    ,count: recordCount //数据总数
                    ,jump: function(obj,first){
                        console.log(obj);
                        pageIndex = obj.curr;
                        if(!first){ //一定要加此判断，否则初始时会无限刷新
                            loadnextpage(obj.curr);//一定要把翻页的ajax请求放到这里，不然会请求两次。
                        }
                    }
                });
            })
        }

        // layui.use(['laypage', 'layer'], function() {
        //     var laypage = layui.laypage
        //         , layer = layui.layer;




        //     function search() {
        //         var textstr = document.getElementById("searchtext").value;
        //         var typestr = document.getElementById("searchtype").value;
        //         if (textstr == "" || textstr == null) {
        //             return;
        //         }
        //         var searchList = new Array();
        //         searchList.push({text: textstr, type: typestr});
        //
        //         $.ajax({
        //             //访问后台的路径
        //             url: "/onclick_search",
        //             //将数据通过函数转换
        //             data: JSON.stringify(searchList),
        //             dataType: "json",//指定数据类型为JSON
        //             // 指定类型，不然会报错，无法解析提交类型
        //             contentType: "application/json;charset=utf-8",
        //             type: 'post',//指定提交方式为post
        //             success: function (data) {
        //                 var jsonData = JSON.stringify(data);
        //                 var spotlist = {};
        //                 jQuery.each(JSON.parse(jsonData), function (i, item) {
        //                     spotlist[i] = item;
        //                 });
        //                 laypage.render({
        //                     elem: 'demo20'
        //                     , count: spotlist.length
        //                     // , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
        //                     , jump: function (obj) {
        //                         dataHtml = '';
        //                         for (var i = obj.curr; i < obj.limit; i++) {
        //                             dataHtml += '<figure>'
        //                                 + '<a href="' + spotlist[i].spotUrl + '"><img src="../../static/io/img/tour' + (i + 1) + '.jpg" alt=""></a>'
        //                                 + '<figcaption>'
        //                                 + '<h3 class="content" > &lt;' + spotlist[i].spotName + '&gt;</h3>'
        //                                 + spotlist[i].introduce
        //                                 + '<div class="info">'
        //                                 + '<em class="sat">' + '满意度' + spotlist[i].spotScore + '</em>'
        //                                 + '<span class="price">' + '￥' + spotlist[i].spotPrice + '</span>'
        //                                 + '</div>'
        //                                 + '<div>' + spotlist[i].spotLocation + '———' + spotlist[i].recommend + '人推荐' + '</div>'
        //                                 + '</figcaption>'
        //                                 + '</figure>'
        //                         }
        //                         $(".spotShow").html(dataHtml);
        //                     }
        //                 });
        //             }
        //
        //         });
        //
        //     }
        // });
	</script>

	<div class = "spotShow"></div>
	<div id="page"></div>

	</div>
<footer id="footer">
    <div class="top">
        <div class="block middle">
            <h3>合作伙伴</h3>
            <hr>
            <ul>
                <li><a target="_blank" href="https://www.ly.com/">同程旅游网</a></li>
                <li><a target="_blank" href="https://www.elong.com/">艺龙旅游网</a></li>
                <li><a target="_blank" href="https://www.ctrip.com/">携程旅游</a></li>
            </ul>


        </div>
        <div class="bottom">Copyright © 1616301</div>
    </div>
</footer>
</body>
</html>