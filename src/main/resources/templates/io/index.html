<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
	<meta charset="UTF-8">
	<title>首页--旅游网站</title>
	<link rel="stylesheet" href="../../static/io/css/iostyle.css">
	<link rel="stylesheet" href="../../static/io/css/basic.css">
	<link rel="icon" href="../../static/favicon.ico">
	<link rel="stylesheet" href="../../static/layui/css/layui.css" media="all" />
	<link rel="stylesheet" href="//at.alicdn.com/t/font_tnyc012u2rlwstt9.css" media="all" />
</head>
<body>
<header>
	<nav id="nav">
	<div id="logo"><img src="../../static/io/img/logo.png" alt=""></div>
	<ul>
		<li><a href="scenery.html">首页</a></li>
		<li><a href="informations.html">旅游资讯</a></li>
		<li><a href="ticket.html">酒店订购</a></li>
		<li class="active"><a href="index.html">景点资讯</a></li>
        <li class="layui-nav-item">
            <a href="/" th:if="${session.loginUser}==null">
                <cite th:text="请登录"></cite>
                <!--                    ${session.loginUser.userName}-->
            </a>
            <a href="/user/userInfo" th:if="${session.loginUser}!=null">
                <cite th:if="${session.loginUser.userName}!=null" th:text="你好+' '+${session.loginUser.userName}"></cite>
                <cite th:if="${session.loginUser.userName}==null" th:text="你好+' '+${session.loginUser.name}"></cite>
                <!--                    ${session.loginUser.userName}-->
            </a>
        </li>

<!--		<a href="javascript:;" th:if="${session.loginUser.userName}!=null">-->
<!--			<cite th:text="${session.loginUser.userName}"></cite>-->
<!--		</a>-->
<!--		<dl class="layui-nav-child">-->
<!--			<dd><a href="javascript:;" data-url="/user/userInfo"><i class="iconfont icon-zhanghu" data-icon="icon-zhanghu"></i><cite>个人资料</cite></a></dd>-->
<!--			<dd><a href="javascript:;" data-url="/user/changePwd"><i class="iconfont icon-shezhi1" data-icon="icon-shezhi1"></i><cite>修改密码</cite></a></dd>-->
<!--			<dd><a href="javascript:;" class="changeSkin"><i class="iconfont icon-huanfu"></i><cite>更换皮肤</cite></a></dd>-->
<!--			<dd><a href="javascript:;" class="signOut"><i class="iconfont icon-loginout"></i><cite>退出</cite></a></dd>-->
<!--		</dl>-->
	</ul>
	</nav>
</header>
<div class="search">
    <div class="center"></div>
    <input class="input" type="text" placeholder="请输入旅游景点或城市" id="searchtext">
    <div class="button searchBtn">
        搜索
	</div>
</div>
<div class="tour">
	<section class="news">
	<h2>热门旅游</h2>
	<p>国内旅游、国外旅游、自助旅游、自驾旅游、油轮签证、主题旅游等各种最新热门旅游推荐</p>
	</section>
	<link rel="stylesheet" href="/static/layui/css/layui.css" media="all">
	<script src="/static/layui/layui.all.js" charset="utf-8"></script>
	<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js" charset="utf-8"></script>
	<script >
        function loaddata()
        {
            $.ajax({
                //访问后台的路径
                url: "/load_data",
                dataType:"json",
                contentType: "application/json;charset=utf-8",
                type: 'post',//指定提交方式为post
                success: function(data) {
                    var jsonData = JSON.stringify(data);
                    var spotlist = {};
                    jQuery.each(JSON.parse(jsonData),function(i,item){
                        spotlist[i] = item;
                    });
                    dataHtml='';
                    for (var i=0;i<9;i++){
                        dataHtml+='<figure>'
                            +'<a href="'+spotlist[i].spotUrl+'" target="_blank"><img src="../../static/io/img/tour'+(i+1)+'.jpg" alt=""></a>'
                            + '<figcaption>'
                            + '<h3 class="content" > &lt;'+ spotlist[i].spotName +'&gt;</h3>'
                                + spotlist[i].introduce
                                +'<div class="info">'
                                +'<em class="sat">'+ '满意度'+spotlist[i].spotScore +'</em>'
                                +'<span class="price">'+ '￥'+spotlist[i].spotPrice +'</span>'
                                +'</div>'
                                +'<div>'+spotlist[i].spotLocation +'—'+spotlist[i].recommend+'人推荐'+'</div>'
                            +'</figcaption>'
                            +'</figure>'
                    }
                    $(".spotShow").html(dataHtml);
                }
            });
        }
        window.onload = loaddata;


        $(".searchBtn").click(function () {
			var index = layer.msg('查询中，请稍候', {icon: 16, time: false, shade: 0.8});
			tosubmit(1);
			setTimeout(function () {
				toPage();
				layer.close(index);
			},2000);
        });

        var pageIndex = 1;
        var pageSize = 9;
        var currentPageIndex = 1;
        var recordCount = 0;

        function tosubmit(cur){
            var textstr = document.getElementById("searchtext").value;
            // var typestr = document.getElementById("searchtype").value;
            if (textstr == "" || textstr == null) {
                return;
            }
            var searchList = new Array();
            searchList.push({text: textstr, yehao: cur});
            $.ajax({
                //访问后台的路径
                url: "/onclick_search",
                //将数据通过函数转换
                data: JSON.stringify(searchList),
                dataType: "json",//指定数据类型为JSON
                // 指定类型，不然会报错，无法解析提交类型
                contentType: "application/json;charset=utf-8",
                type: 'post',//指定提交方式为post
                success: function (data) {
                    pageIndex = data.pageNum;
                    recordCount = data.total;
                    if (data.list != null) {
                        getListInfo(data.list);
                    }
                }
            });

        }

        function getListInfo(data){
            var jsonData = JSON.stringify(data);
            var spotlist = {};
            jQuery.each(JSON.parse(jsonData), function (i, item) {
                spotlist[i] = item;
            });
            dataHtml = '';
            for (var i = 0; i < 9; i++) {
                dataHtml += '<figure>'
                    + '<a href="' + spotlist[i].spotUrl + '" target="_blank"><img src="../../static/io/img/tour' + (i + 1) + '.jpg" alt=""></a>'
                    + '<figcaption>'
                    + '<h3 class="content" > &lt;' + spotlist[i].spotName + '&gt;</h3>'
                    + spotlist[i].introduce
                    + '<div class="info">'
                    + '<em class="sat">' + '满意度' + spotlist[i].spotScore + '</em>'
                    + '<span class="price">' + '￥' + spotlist[i].spotPrice + '</span>'
                    + '</div>'
                    + '<div>' + spotlist[i].spotLocation + '———' + spotlist[i].recommend + '人推荐' + '</div>'
                    + '</figcaption>'
                    + '</figure>'
            }
            $(".spotShow").html(dataHtml);
        }


        function toPage() {
            layui.use(['laypage', 'layer'], function(){
                var laypage = layui.laypage
                    ,layer = layui.layer;
                //总页数大于页码总数
                laypage.render({
                    elem: 'page'
                    ,layout: ['count', 'prev', 'page', 'next' ]
                    ,count: recordCount //数据总数
                    ,jump: function(obj,first){
                        console.log(obj);
                        pageIndex = obj.curr;
                        if(!first){ //一定要加此判断，否则初始时会无限刷新
                            tosubmit(obj.curr);//一定要把翻页的ajax请求放到这里，不然会请求两次。
                        }
                    }
                });
            })
        }

        // layui.use(['laypage', 'layer'], function() {
        //     var laypage = layui.laypage
        //         , layer = layui.layer;




        //     function search() {
        //         var textstr = document.getElementById("searchtext").value;
        //         var typestr = document.getElementById("searchtype").value;
        //         if (textstr == "" || textstr == null) {
        //             return;
        //         }
        //         var searchList = new Array();
        //         searchList.push({text: textstr, type: typestr});
        //
        //         $.ajax({
        //             //访问后台的路径
        //             url: "/onclick_search",
        //             //将数据通过函数转换
        //             data: JSON.stringify(searchList),
        //             dataType: "json",//指定数据类型为JSON
        //             // 指定类型，不然会报错，无法解析提交类型
        //             contentType: "application/json;charset=utf-8",
        //             type: 'post',//指定提交方式为post
        //             success: function (data) {
        //                 var jsonData = JSON.stringify(data);
        //                 var spotlist = {};
        //                 jQuery.each(JSON.parse(jsonData), function (i, item) {
        //                     spotlist[i] = item;
        //                 });
        //                 laypage.render({
        //                     elem: 'demo20'
        //                     , count: spotlist.length
        //                     // , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
        //                     , jump: function (obj) {
        //                         dataHtml = '';
        //                         for (var i = obj.curr; i < obj.limit; i++) {
        //                             dataHtml += '<figure>'
        //                                 + '<a href="' + spotlist[i].spotUrl + '"><img src="../../static/io/img/tour' + (i + 1) + '.jpg" alt=""></a>'
        //                                 + '<figcaption>'
        //                                 + '<h3 class="content" > &lt;' + spotlist[i].spotName + '&gt;</h3>'
        //                                 + spotlist[i].introduce
        //                                 + '<div class="info">'
        //                                 + '<em class="sat">' + '满意度' + spotlist[i].spotScore + '</em>'
        //                                 + '<span class="price">' + '￥' + spotlist[i].spotPrice + '</span>'
        //                                 + '</div>'
        //                                 + '<div>' + spotlist[i].spotLocation + '———' + spotlist[i].recommend + '人推荐' + '</div>'
        //                                 + '</figcaption>'
        //                                 + '</figure>'
        //                         }
        //                         $(".spotShow").html(dataHtml);
        //                     }
        //                 });
        //             }
        //
        //         });
        //
        //     }
        // });
	</script>

	<div class = "spotShow"></div>
	<div id="page"></div>

	</div>
<footer id="footer">
    <div class="top">
        <div class="block middle">
            <h3>合作伙伴</h3>
            <hr>
            <ul>
                <li><a target="_blank" href="https://www.ly.com/">同程旅游网</a></li>
                <li><a target="_blank" href="https://www.elong.com/">艺龙旅游网</a></li>
                <li><a target="_blank" href="https://www.ctrip.com/">携程旅游</a></li>
            </ul>


        </div>
        <div class="bottom">Copyright © 1616301</div>
    </div>
</footer>
</body>
</html>